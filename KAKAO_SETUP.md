# 카카오톡 채널 설정 가이드

StudyMate 챗봇을 카카오톡에서 사용하기 위한 상세 설정 가이드입니다.

## 1. 카카오 비즈니스 계정 생성

### 1.1 카카오 비즈니스 가입
1. [카카오 비즈니스](https://business.kakao.com/) 접속
2. "시작하기" 클릭
3. 카카오 계정으로 로그인
4. 사업자 정보 입력 (개인사업자 또는 법인)

### 1.2 채널 생성
1. 대시보드에서 "채널 만들기" 클릭
2. 채널 정보 입력:
   - 채널명: `studymate`
   - 카테고리: `교육`
   - 채널 소개: `AI 기반 학습 도우미 챗봇`
3. 프로필 이미지 업로드 (선택사항)

## 2. 챗봇 설정

### 2.1 챗봇 활성화
1. 채널 관리 > 챗봇 메뉴로 이동
2. "챗봇 사용" 활성화
3. "API형 챗봇" 선택

### 2.2 웹훅 URL 설정
```
웹훅 URL: https://your-domain.com/kakao/webhook
```

**주의사항:**
- 반드시 HTTPS 프로토콜 사용
- 도메인은 실제 배포된 서버 주소로 변경
- 포트 번호가 있다면 포함 (예: https://example.com:5002/kakao/webhook)

### 2.3 이벤트 설정
다음 이벤트들을 활성화하세요:
- ✅ 메시지 수신
- ✅ 이미지 수신
- ✅ 버튼 클릭
- ✅ 사용자 추가

## 3. 봇 메뉴 설정

### 3.1 기본 메뉴 구성
카카오톡 채널에서 다음과 같은 메뉴를 설정하세요:

```
📚 StudyMate 메뉴
├── 📸 문제풀이
├── 📅 스터디 플래너  
└── ❓ 도움말
```

### 3.2 상세 버튼 설정

**버튼 1: 문제풀이**
- 버튼명: `📸 문제풀이`
- 버튼 타입: `메시지 전송`
- 전송 메시지: `photo_solve`
- 설명: `문제 사진을 보내주세요!`

**버튼 2: 스터디 플래너**
- 버튼명: `📅 스터디 플래너`
- 버튼 타입: `웹 링크`
- URL: `https://your-domain.com/planner/{user_id}`
- 설명: `개인 스터디 플래너를 확인하세요`

**버튼 3: 도움말**
- 버튼명: `❓ 도움말`
- 버튼 타입: `메시지 전송`
- 전송 메시지: `help`
- 설명: `사용법을 안내해드립니다`

## 4. 자동응답 메시지 설정

### 4.1 환영 메시지
```
안녕하세요! 📚 StudyMate입니다.

🎯 주요 기능:
📸 문제풀이 - 사진으로 문제를 보내주세요
📅 스터디 플래너 - 개인 학습 계획을 관리하세요

아래 메뉴를 선택해주세요! 👇
```

### 4.2 기본 응답 메시지
```
죄송합니다. 이해하지 못했어요 😅

다음 기능을 이용해보세요:
📸 문제풀이 - 문제 사진 업로드
📅 스터디 플래너 - 학습 계획 관리

메뉴에서 원하는 기능을 선택해주세요!
```

## 5. 테스트 및 검증

### 5.1 웹훅 연결 테스트
1. 카카오 비즈니스 관리자에서 "테스트 발송" 실행
2. 서버 로그에서 웹훅 수신 확인
3. 응답 메시지가 정상적으로 전송되는지 확인

### 5.2 기능 테스트
1. **문제풀이 테스트:**
   - "📸 문제풀이" 버튼 클릭
   - 수학 문제 이미지 업로드
   - AI 풀이 응답 확인

2. **플래너 테스트:**
   - "📅 스터디 플래너" 버튼 클릭
   - 웹 인터페이스 정상 로드 확인
   - 할 일 추가/수정/삭제 테스트

## 6. 배포 전 체크리스트

### 6.1 서버 설정
- [ ] HTTPS 인증서 설정 완료
- [ ] 도메인 DNS 설정 완료
- [ ] 방화벽 포트 개방 (80, 443, 5002)
- [ ] OpenAI API 키 환경변수 설정

### 6.2 카카오톡 설정
- [ ] 웹훅 URL 정상 응답 확인
- [ ] 봇 메뉴 설정 완료
- [ ] 자동응답 메시지 설정 완료
- [ ] 채널 공개 설정 (필요시)

### 6.3 기능 테스트
- [ ] 문제풀이 기능 정상 작동
- [ ] 플래너 웹 인터페이스 정상 작동
- [ ] 데이터베이스 연결 정상
- [ ] 에러 로깅 설정 완료

## 7. 운영 및 모니터링

### 7.1 로그 모니터링
```bash
# 실시간 로그 확인
tail -f /var/log/studymate/app.log

# 에러 로그 확인
grep "ERROR" /var/log/studymate/app.log
```

### 7.2 성능 모니터링
- API 응답 시간 모니터링
- 데이터베이스 성능 확인
- 서버 리소스 사용량 확인

### 7.3 사용자 피드백 수집
- 챗봇 사용 통계 분석
- 사용자 문의 및 피드백 관리
- 기능 개선 사항 수집

## 8. 문제 해결

### 8.1 웹훅 연결 실패
**증상:** 카카오톡 메시지에 응답하지 않음

**해결방법:**
1. 웹훅 URL이 HTTPS인지 확인
2. 서버가 정상 실행 중인지 확인
3. 방화벽 설정 확인
4. SSL 인증서 유효성 확인

### 8.2 이미지 처리 오류
**증상:** 사진 업로드 후 응답 없음

**해결방법:**
1. OpenAI API 키 확인
2. 이미지 파일 크기 제한 확인
3. 네트워크 연결 상태 확인
4. API 사용량 한도 확인

### 8.3 플래너 접속 오류
**증상:** 플래너 버튼 클릭 시 페이지 로드 실패

**해결방법:**
1. 웹 서버 정상 실행 확인
2. 정적 파일 경로 확인
3. CORS 설정 확인
4. 브라우저 호환성 확인

## 9. 고급 설정

### 9.1 사용자 인증
개인정보 보호를 위해 사용자별 인증을 추가할 수 있습니다:

```python
# 사용자 인증 미들웨어 예시
def authenticate_user(kakao_user_id):
    # 사용자 검증 로직
    return True
```

### 9.2 메시지 암호화
민감한 데이터 전송 시 암호화를 적용할 수 있습니다:

```python
# 메시지 암호화 예시
import cryptography
def encrypt_message(message):
    # 암호화 로직
    return encrypted_message
```

### 9.3 부하 분산
대용량 트래픽 처리를 위한 로드 밸런서 설정:

```nginx
# Nginx 로드 밸런서 설정 예시
upstream studymate_backend {
    server 127.0.0.1:5002;
    server 127.0.0.1:5003;
}
```

이 가이드를 따라 설정하시면 StudyMate 카카오톡 챗봇을 성공적으로 운영할 수 있습니다.

